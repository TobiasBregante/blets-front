{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect, useRef } from 'react';\nimport { useCookies } from 'react-cookie';\nimport { useRouter } from \"next/router\";\nimport CurrencyFormat from 'react-currency-format';\nimport SendTransaction from './send.transaction.component';\nimport RemoveProduct from '../management/remove.product.component';\nimport EditProduct from '../management/edit.product.component';\nimport { Image, Transformation, CloudinaryContext } from 'cloudinary-react';\nimport Link from 'next/link';\nimport SwitchPrice from './price.convert.component';\nimport axios from 'axios';\nimport moment from 'moment';\n\nconst Product = ({\n  router\n}) => {\n  const Router = useRouter();\n  const imgRef = useRef(null);\n  const {\n    id,\n    name\n  } = Router.query;\n  const imgContent = useRef(null);\n  const {\n    0: credential,\n    1: setCredential\n  } = useState('');\n  const {\n    0: imgContentState,\n    1: setImgContentState\n  } = useState('');\n  const [cookies, setCookie] = useCookies(['user']);\n  const {\n    0: product,\n    1: setProduct\n  } = useState([]);\n  const {\n    0: packageSendingAlert,\n    1: setPackageSendingAlert\n  } = useState('d-none');\n  const {\n    0: acceptPaymentSwitch,\n    1: setAcceptPaymentSwitch\n  } = useState('accept-payment-close');\n  const {\n    0: valueBtnSwitchPayment,\n    1: setValueBtnSwitchPayment\n  } = useState('Comprar');\n  const {\n    0: discountHiddeNotLogged,\n    1: setDiscountHiddeNotLogged\n  } = useState('');\n  const {\n    0: imageProd,\n    1: setImageProd\n  } = useState('/img/img-not-found.png');\n  const {\n    0: imgUpload,\n    1: setImgUpload\n  } = useState({});\n  const {\n    0: discount,\n    1: setDiscount\n  } = useState('');\n  const {\n    0: amount,\n    1: setAmount\n  } = useState('');\n\n  const HandlerFindUser = async idUser => {\n    const getUser = await axios.get(`${process.env.API_PATH}/v1/user/${idUser}`),\n          resUser = await getUser.data;\n    return resUser;\n  };\n\n  const getAllProduct = async () => {\n    const fetchAll = await fetch(`${process.env.API_PATH}/v1/product/${id}`, {\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*'\n      }\n    });\n    const dataFetch = await fetchAll.json();\n    setProduct(dataFetch);\n    setAmount(dataFetch.amount);\n    setDiscount(dataFetch.discount);\n    cookies.user && !cookies.user.discount_token || !cookies.user || product.discount <= 0 ? setDiscountHiddeNotLogged('d-none') : setDiscountHiddeNotLogged('');\n    return dataFetch;\n  };\n\n  useEffect(() => {\n    if (cookies.user && cookies.user.rol !== 'master') {\n      setCredential('false');\n    } else if (!cookies.user) {\n      setCredential('false');\n    }\n\n    if (cookies.user && cookies.user.rol === 'master') {\n      setCredential('true');\n    }\n\n    product.img && setImgContentState(imgContent.current.offsetWidth);\n  });\n  useEffect(() => {\n    if (Router.asPath !== Router.route) {\n      getAllProduct();\n    }\n  }, [Router]);\n\n  const handlerAcceptPaymentSwitch = e => {\n    if (cookies.user) {\n      if (acceptPaymentSwitch === 'accept-payment-close') {\n        e.target.classList.toggle('btn-danger');\n        e.target.classList.remove('btn-buy-now');\n        setValueBtnSwitchPayment('Cerrar');\n        setAcceptPaymentSwitch('');\n      } else {\n        e.target.classList.toggle('btn-danger');\n        e.target.classList.add('btn-buy-now');\n        setValueBtnSwitchPayment('Pagar con Mercado Pago!');\n        setAcceptPaymentSwitch('accept-payment-close');\n      }\n    } else {\n      window.location = '/iniciar-sesion';\n    }\n  },\n        handlerTransaction = async () => {\n    const customer = await HandlerFindUser(cookies.user.id);\n    setPackageSendingAlert('');\n    let frmData = new FormData();\n    frmData.append('id_product', product._id);\n    frmData.append('product', JSON.stringify(product));\n    frmData.append('payer', JSON.stringify(customer));\n    frmData.append('token_influencer', cookies.user.discount_token ? cookies.user.discount_token : 'organic');\n    frmData.append('id_client', cookies.user && cookies.user.id);\n    frmData.append('status_transaction', 'pending');\n    frmData.append('proof_payment', imgRef.current.files[0]);\n    frmData.append('create_at', `${moment()._d}`);\n    frmData.append('create_at_filter', moment().format('YYYY-MM-DD'));\n    const resTransaction = await SendTransaction(frmData, cookies);\n    return resTransaction;\n  },\n        imgPreviewProd = e => {\n    let reader = new FileReader();\n\n    reader.onloadend = () => {\n      setImageProd(reader.result);\n    };\n\n    if (e.target.files[0]) {\n      setImgUpload(e.target.files[0]);\n      reader.readAsDataURL(e.target.files[0]);\n    } else {\n      setImageProd('');\n    }\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"section\", {\n    className: \"row section-product\"\n  }, __jsx(\"article\", {\n    className: \"col-12 col-sm-12 col-lg-12 col-xl-12 p-0 mt-1\"\n  }, __jsx(\"nav\", {\n    \"aria-label\": \"breadcrumb\"\n  }, __jsx(\"ol\", {\n    className: \"breadcrumb\"\n  }, __jsx(\"li\", {\n    className: \"breadcrumb-item\"\n  }, __jsx(Link, {\n    href: \"/\",\n    as: \"/\"\n  }, __jsx(\"a\", null, \"Inicio\"))), __jsx(\"li\", {\n    className: \"breadcrumb-item active text-light\",\n    \"aria-current\": \"page\"\n  }, name)))), __jsx(\"article\", {\n    className: \"col-12 col-sm-12 col-lg-8 col-xl-8\"\n  }, __jsx(\"article\", {\n    ref: imgContent,\n    className: \"col-12 content-img-prod-open\"\n  }, credential === 'true' ? __jsx(RemoveProduct, {\n    product: product\n  }) : false, credential === 'true' ? __jsx(EditProduct, {\n    product: product\n  }) : false, product.img ? __jsx(CloudinaryContext, {\n    cloudName: \"blets\"\n  }, __jsx(Image, {\n    className: \"card-img\",\n    publicId: `${product.img}.jpg`\n  }, __jsx(Transformation, {\n    crop: \"scale\",\n    quality: \"40\",\n    width: imgContentState - 50,\n    dpr: \"auto\"\n  }))) : ''), __jsx(\"article\", {\n    className: \"product-description-content col-12 p-5\"\n  }, __jsx(\"h2\", {\n    className: \"col-2\"\n  }, \"Descripci\\xF3n\"), __jsx(\"hr\", null), __jsx(\"ul\", {\n    type: \"none\"\n  }, __jsx(\"li\", null, \"- Categor\\xEDa: \", __jsx(\"span\", {\n    className: \"text-light\"\n  }, __jsx(\"strong\", null, product.type)), __jsx(\"br\", null)), product.subcategory ? __jsx(\"li\", null, \"- Edici\\xF3n: \", __jsx(\"span\", {\n    className: \"text-light\"\n  }, __jsx(\"strong\", null, product.subcategory))) : '', __jsx(\"li\", null, \"- Nombre del negocio: \", __jsx(\"span\", {\n    className: \"text-light\"\n  }, __jsx(\"strong\", null, product.business))), __jsx(\"li\", null, \"- Ubicaci\\xF3n: \", __jsx(\"span\", {\n    className: \"text-light\"\n  }, __jsx(\"strong\", null, product.location)))), __jsx(\"hr\", null), __jsx(\"p\", null, product.description))), __jsx(\"article\", {\n    className: \"col-12 col-sm-12 col-lg-4 col-xl-4 p-3\"\n  }, __jsx(\"article\", {\n    className: \"col-12 card\"\n  }, __jsx(\"article\", {\n    className: \"card-body\"\n  }, __jsx(\"h1\", {\n    className: \"text-secondary component-info-buy\"\n  }, product.title), __jsx(\"h4\", {\n    className: `text-dark component-info-buy`\n  }, amount && discount && __jsx(SwitchPrice.SwitchPriceAuth, {\n    discount: discount,\n    amount: amount\n  })), __jsx(\"strike\", {\n    className: \"text-secondary\"\n  }, __jsx(\"h5\", {\n    className: `component-info-buy ${discountHiddeNotLogged}`\n  }, __jsx(CurrencyFormat, {\n    value: product.amount,\n    displayType: 'text',\n    thousandSeparator: true,\n    prefix: '$'\n  }))), __jsx(\"p\", {\n    className: \"col-12 col-sm-12 col-lg-6 col-xl-6 p-0 m-0\"\n  }, __jsx(\"span\", {\n    className: `${!product.shipping ? 'd-none' : 'd-block'} shipping-open bg-primary text-light`\n  }, \"Lo recib\\xEDs en tu domicilio\"), __jsx(\"span\", {\n    className: `shipping-open bg-success text-light d-block`\n  }, \"Env\\xEDo gratis\")))), __jsx(\"article\", {\n    className: \"col-12 card mt-1\"\n  }, __jsx(\"article\", {\n    className: \"card-body\"\n  }, __jsx(\"p\", {\n    className: \"text-dark component-info-buy\"\n  }, \"Pag\\xE1 al contado o en cuotas con\", __jsx(\"span\", {\n    className: \"text-info\"\n  }, \" \", __jsx(\"strong\", null, \"Mercado Pago\"))), __jsx(\"p\", null, __jsx(\"span\", {\n    className: \"bg-primary p-2 text-light\"\n  }, \"Se encuentra en \", __jsx(\"strong\", null, product.location))), __jsx(\"hr\", null), __jsx(\"p\", null, __jsx(\"img\", {\n    className: \"ico-payments\",\n    src: \"../img/visa.png\",\n    alt: \"Visa\"\n  }), __jsx(\"img\", {\n    className: \"ico-payments\",\n    src: \"../img/mastercard.png\",\n    alt: \"Mastercard\"\n  }), __jsx(\"img\", {\n    className: \"ico-payments\",\n    src: \"../img/transfer.png\",\n    alt: \"Transferencia\"\n  }), __jsx(\"img\", {\n    className: \"ico-payments\",\n    src: \"../img/mp.webp\",\n    alt: \"Mercado Pago\"\n  })), __jsx(\"article\", {\n    className: `col-12 accept-payment ${acceptPaymentSwitch}`\n  }, __jsx(\"article\", {\n    className: `content--btn-payment p-5 ${acceptPaymentSwitch}`\n  }, __jsx(\"article\", {\n    className: \"btn-content\"\n  }, __jsx(\"input\", {\n    onClick: () => window.open(\"http://localhost:3000\", \"Popup\", \"toolbar=no, location=no, statusbar=no, menubar=no, scrollbars=1, resizable=0, width=580, height=600, top=30\"),\n    className: \"btn btn-primary d-block mb-1\",\n    type: \"button\",\n    value: \"Continuar con Mercado Pago\"\n  }), __jsx(\"div\", {\n    class: `alert alert-success mt-1 mb-1 ${packageSendingAlert}`,\n    role: \"alert\"\n  }, \"Tu pedido se ha enviado! Pronto nos pondremos en cont\\xE1cto. Sea paciente, por favor.\"), __jsx(\"p\", {\n    className: \"mt-3 d-none\"\n  }, \"Continuar con transferencia bancaria: \", __jsx(\"span\", {\n    className: \"text-warning\"\n  }, \"CBU \", product.CBU)), __jsx(\"p\", {\n    className: \"mt-4\"\n  }, __jsx(\"strong\", {\n    className: \"text-warning\"\n  }, \"IMPORTANTE\"), __jsx(\"small\", {\n    className: \"d-block\"\n  }, \"Env\\xEDar screenshot del comprobante de pago\"), __jsx(\"label\", {\n    htmlFor: \"screenshot-payment\",\n    className: \"btn btn-success\"\n  }, \"Subir archivo\"), __jsx(\"input\", {\n    ref: imgRef,\n    type: \"file\",\n    onChange: imgPreviewProd,\n    className: \"d-none\",\n    id: \"screenshot-payment\"\n  }), __jsx(\"input\", {\n    type: \"button\",\n    onClick: handlerTransaction,\n    className: \"btn btn-warning d-block\",\n    value: \"Enviar archivo\"\n  }), __jsx(\"img\", {\n    src: imageProd,\n    alt: \"preview proof\",\n    className: \"proof-preview-prod\"\n  }))))), __jsx(\"input\", {\n    onClick: handlerAcceptPaymentSwitch,\n    type: \"button\",\n    className: \"btn btn-buy-now text-light col-12\",\n    value: valueBtnSwitchPayment\n  }))))));\n}; // 0720006988000038698918\n\n\nexport default Product;","map":null,"metadata":{},"sourceType":"module"}